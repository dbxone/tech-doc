# DBX cold wallet offline signature

##### Cold wallet is one of the methods to realize cold storage\(Cold storage\), referring to the user generating private key when the wallet is offline and saving it properly. Since the private key generated offline will never appear on any online endpoint or network, it won't be found or stolen by the hacker. The key part of cold storage is to 100% ensure that your private key generated by cold storage won't appear on network or online computers, so always be sure that the cold wallet is always in offline status and separately used from the hot wallet\(hot wallet\), safely processing the transaction by offline signature.

---

## Brief steps：

1. In the offline machine, start witness_node and cli_walle. At cli_wallet endpoint, use suggest_brain_key command to generate encrypted key pairs offline;
2. Use light weighted wallet\(light_wallet\) to modify the public key for the active permission of the account, remove the original one and add in the aforementioned public key so that the private key is saved offline and the account is in cold storage status;

3. When you need to use the account in cold storage status, start the offline machine, generate a broadcasting message for the transfer operation;

4. Start witness_node at one online node，broadcast the above message to the network.

## Detailed steps：

##### 1）Preparation

* Two machines\(One online, the other offline\), install and start witness_node and cli_wallet，in addition synchronize blocks to the local space, ensure the used account is on the chain

##### 2）Initiate command：

witness_node initiates command, at back desk:

```
./programs/witness_node/witness_node --rpc-endpoint=127.0.0.1:38090 --p2p-endpoint=0.0.0.0:38091 --log-file &
```

cli_wallet starts command：

```
./programs/cli_wallet/cli_wallet -s ws://127.0.0.1:38090 -r 127.0.0.1:38091
```

##### 3）Generate encrypted key pairs offline

Using offline machine，start witness_node and cli_wallet，enter suggest_brain_key command \(the precondition is the wallet has been unlocked\)at cli_wallet endpoint, generate encrypted key pairs offline.

```
unlocked >>> suggest_brain_key 
{
 "brain_priv_key": "SWOM RECAP DOOM EGERAN ELEMENT DUBASH GIRLISH SIBBER 
  COIGN KISMET MOTHY CHIRK BOUN SAGGY HIDLING NATTY",
 "wif_priv_key": "5KFSF8nfh3GfmBC55cmkhJ3pU4PeGxyXuAKAfNyztfvnuyeJBqz",
 "pub_key": "DBX6AFW7aD9d3kH3AXo3HwJZdQE5zVVMsoewvGVEpgQTqyZT37Xct" 
}
```

##### 4）Modify public key for active permission of the account by dbx-light weighted wallet

1. First import the private key of the cold wallet account to the light weighted wallet，then click "Account"-“Permission”-"Active permission"；

2. Add pub_key generated at step “3）”, the weight is 1，meanwhile remove the original public key, save the modification\(1 DBX is needed as commission，DBX asset is needed when matching to the exchange\). After modifying the public key, the private key is saved in the offline machine, the account is in cold storage status.

##### 5）Transfer by using cold storage account

Start the witness_node and cli_wallet of the offline machine, import private key of the account\(all following commands will be executed in cli_wallet\):

```
unlock >>> import_key <account_name> <wif_priv_key> true
```

Begin to form the broadcasting structure:

1）Begin to construct forwarding structure：

```
For example：
unlocked >>> begin_builder_transaction
0
```

2）Generate transaction structure body operation\( Here is the transfer operation\) :

```
add_operation_to_builder_transaction $HANDLE <operation>

Note:$HANDLE is the return value of begin_builder_transaction interface，the following is the same <operation> is the report
<operation> concrete explanation
[                                              //Fixed format，no need to change  
 0,{                                           //Fixed format，no need to change
  "fee": {                                     //Fixed format，no need to change
   "amount": 0,                                //Fixed format，no need to change
   "asset_id": "1.3.0"                         //Asset type, 1.3.0 is "DBX", 1.3.1 is "DBX"
  },                                           //Fixed format，no need to change
  "from": "1.2.17",                            //Source account of the transfer id (here is 1.2.17)
  "to": "1.2.18",                              //Source account of the transfer id (here is 1.2.18)
  "amount": {                                  //Fixed format，no need to change
   "amount": 0,                                //Fixed format，no need to change
   "asset_id": "1.3.0"                         //Asset type, 1.3.0 is "DBX", 1.3.1 is "DBX"
  },                                           //Fixed format，no need to change
  "extensions": []                             //Fixed format，no need to change
 }                                             //Fixed format，no need to change
]                                              //Fixed format，no need to change
```

```
For example：
unlocked >>> add_operation_to_builder_transaction 0 [0,{"fee": { "amount": 0,"asset_id": "1.3.0"},\
"from": "1.2.17","to": "1.2.18","amount": {"amount": 1000000,"asset_id": "1.3.0"},"extensions": []}]
null
```
<operation> report format could be acquired according to the get_prototype_operation interface，shown as follows：

```
unlocked >>> get_prototype_operation transfer_operation
[
  0,{
    "fee": {
      "amount": 0,
      "asset_id": "1.3.0"
    },
    "from": "1.2.0",
    "to": "1.2.0",
    "amount": {
      "amount": 0,
      "asset_id": "1.3.0"
    },
    "extensions": []
  }
]
```


3）Set operation commission：

```
set_fees_on_builder_transaction $HANDLE $GRAPHENE_SYMBOL
Note：$GRAPHENE_SYMBOL must be "DBX"
```

```
unlocked >>> set_fees_on_builder_transaction 0 DBX
{
  "amount": 10000,
  "asset_id": "1.3.1"
}
```

4）Preview the transaction：

```
preview_builder_transaction $HANDLE
```

```
For example：
unlocked >>> preview_builder_transaction 0
{
  "ref_block_num": 0,
  "ref_block_prefix": 0,
  "expiration": "1970-01-01T00:00:00",
  "operations": [[
      0,{
        "fee": {
          "amount": 10000,
          "asset_id": "1.3.1"
        },
        "from": "1.2.17",
        "to": "1.2.18",
        "amount": {
          "amount": 1000000,
          "asset_id": "1.3.0"
        },
        "extensions": []
      }
    ]
  ],
  "extensions": []
}
```

5）Transactions generating signature：

```
sign_builder_transaction $HANDLE false
```

```
For example：
unlocked >>> sign_builder_transaction 0 false
{
  "ref_block_num": 21422,
  "ref_block_prefix": 3156211995,
  "expiration": "2018-01-25T14:12:15",
  "operations": [[
      0,{
        "fee": {
          "amount": 2500,
          "asset_id": "1.3.1"
        },
        "from": "1.2.17",
        "to": "1.2.19",
        "amount": {
          "amount": 1000000,
          "asset_id": "1.3.1"
        },
        "extensions": []
      }
    ]
  ],
  "extensions": [],
  "signatures": [
    "200140efcf4d5b1c44ce3ce3c25b3f3ad2090444259c45495e1764489b95156e9d6ed8ce7b2c77ea8fa464cf537ab2f17d3b8d4b84d316c6445eb1918ebd32d5da"
  ]
}
```

6）Start witness_node and cli_wallet of the online machine, then copy the report generated in the last step to the machine:

```
broadcast_transaction $tx
```

```
For example：
locked >>>  broadcast_transaction {"ref_block_num":21422,"ref_block_prefix":3156211995,"expiration":"2018-01-25T14:12:15","operations":[[0,{"fee":{"amount":2500,"asset_id":"1.3.1"},"from":"1.2.17","to":"1.2.19","amount":{"amount":1000000,"asset_id":"1.3.1"},"extensions":[]}]],"extensions":[],"signatures":["200140efcf4d5b1c44ce3ce3c25b3f3ad2090444259c45495e1764489b95156e9d6ed8ce7b2c77ea8fa464cf537ab2f17d3b8d4b84d316c6445eb1918ebd32d5da"]}
[
  "314a701ab1d598418b0104ef99f0eabb2bef8f3a",{
    "ref_block_num": 21422,
    "ref_block_prefix": 3156211995,
    "expiration": "2018-01-25T14:12:15",
    "operations": [[
        0,{
          "fee": {
            "amount": 2500,
            "asset_id": "1.3.1"
          },
          "from": "1.2.17",
          "to": "1.2.19",
          "amount": {
            "amount": 1000000,
            "asset_id": "1.3.1"
          },
          "extensions": []
        }
      ]
    ],
    "extensions": [],
    "signatures": [
      "200140efcf4d5b1c44ce3ce3c25b3f3ad2090444259c45495e1764489b95156e9d6ed8ce7b2c77ea8fa464cf537ab2f17d3b8d4b84d316c6445eb1918ebd32d5da"
    ]
  }
]
```
